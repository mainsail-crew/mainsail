<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <title>Mainsail</title>
        <meta name="description" content="Mainsail is the popular web interface for Klipper." />

        <link rel="icon" type="image/png" sizes="32x32" href="/img/icons/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/img/icons/favicon-16x16.png" />
        <meta name="theme-color" content="#121212" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="apple-mobile-web-app-title" content="Mainsail" />
        <link rel="apple-touch-icon" sizes="180x180" href="/img/icons/apple-touch-icon-180x180.png" />
        <link rel="mask-icon" href="img/icons/safari-pinned-tab.svg" color="#d51f26" />
        <meta name="msapplication-TileImage" content="/img/icons/mstile-150x150.png" />
        <meta name="msapplication-TileColor" content="#d51f26" />
        <script type="module" src="/src/main.ts"></script>
        <script>
            // Since Mainsail installs as a PWA, it's possible for the index to load from disk but the main script files
            // need to be pulled from the server. If the server is offline or we can't connect, the JS file load fails,
            // the website just shows a black, blank, screen. The small script below binds to all of the script tags and if
            // any fail to load, add some text to the main body to indicate something is wrong.
            var hasShownLoadFailedError = false
            var hasMainScriptLoaded = false
            function OnScriptLoadFailed() {
                if (hasShownLoadFailedError) {
                    return
                }
                if (hasMainScriptLoaded) {
                    return
                }
                hasShownLoadFailedError = true
                var div = document.createElement('div')
                div.style.cssText =
                    'color:white; height:100%; width:100%; font-size:20px; text-align:center; padding:20px; padding-top: 100px; font-family:Roboto, sans-serif'
                div.innerHTML = '<span>Mainsail unable to connect.<br/>Is your Klipper device online?</span>'
                document.body.appendChild(div)
            }
            var scripts = document.getElementsByTagName('script')
            for (var i = 0; i < scripts.length; i++) {
                var scriptTag = scripts[i]
                // Only target script tags with a src.
                if (scriptTag.src != undefined && scriptTag.src != null) {
                    scriptTag.addEventListener('error', function () {
                        OnScriptLoadFailed()
                    })
                    scriptTag.addEventListener('load', function () {
                        // Once the main script loads, don't do anything for any future failures.
                        hasMainScriptLoaded = true
                    })
                }
            }
        </script>
    </head>
    <body style="background-color: #121212">
        <noscript>
            <strong>
                We're sorry but Mainsail doesn't work properly without JavaScript enabled. Please enable it to continue.
            </strong>
        </noscript>
        <div id="app"></div>
    </body>
</html>
